{"version":3,"sources":["pages/login/login.component.ts"],"names":[],"mappings":"AAAA;;GAEG;;;;;;;;;;;;AAEH,sCAAkD;AAClD,0CAAyD;AAEzD,8CAA2E;AAC3E,gEAA4D;AAO5D,IAAa,cAAc;IAKvB,wBACY,KAAqB,EACrB,MAAc,EACd,qBAA4C,EAC5C,YAA0B,EAC1B,aAA6B;QAJ7B,UAAK,GAAL,KAAK,CAAgB;QACrB,WAAM,GAAN,MAAM,CAAQ;QACd,0BAAqB,GAArB,qBAAqB,CAAuB;QAC5C,iBAAY,GAAZ,YAAY,CAAc;QAC1B,kBAAa,GAAb,aAAa,CAAgB;QATzC,UAAK,GAAQ,EAAE,CAAC;QAChB,YAAO,GAAG,KAAK,CAAC;IASZ,CAAC;IAEL,iCAAQ,GAAR;QACI,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,GAAG,CAAC;QACrE,EAAE,CAAA,CAAC,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;YACtC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;YACvC,MAAM,CAAC;QACX,CAAC;QACD,IAAI,CAAC,qBAAqB,CAAC,MAAM,EAAE,CAAC;QACpC,IAAI,CAAC,aAAa,CAAC,OAAO,GAAG,KAAK,CAAC;QACnC,yDAAyD;IAC7D,CAAC;IAED,8BAAK,GAAL;QAAA,iBAsBC;QArBG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;QACpB,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;aACrE,SAAS,CACN,UAAA,IAAI;YACA;;eAEG;YACH,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;gBACZ,kGAAkG;gBAClG,YAAY,CAAC,OAAO,CAAC,cAAc,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;gBACjE,KAAI,CAAC,aAAa,CAAC,OAAO,GAAG,IAAI,CAAC;gBAClC,KAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,KAAI,CAAC,SAAS,CAAC,CAAC,CAAC;YAC3C,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,KAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAC7C,CAAC;YACD,KAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACzB,CAAC,EACD,UAAA,KAAK;YACD,KAAI,CAAC,YAAY,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YACrC,KAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACzB,CAAC,CAAC,CAAC;IACf,CAAC;IACL,qBAAC;AAAD,CA/CA,AA+CC,IAAA;AA/CY,cAAc;IAL1B,gBAAS,CAAC;QACP,uBAAuB;QACvB,WAAW,EAAE,wBAAwB;KACxC,CAAC;qCAQqB,uBAAc;QACb,eAAM;QACS,6BAAqB;QAC9B,oBAAY;QACV,8BAAa;GAVhC,cAAc,CA+C1B;AA/CY,wCAAc","file":"login.component.js","sourcesContent":["/**\r\n * Created by ori on 4/27/2017.\r\n */\r\n\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { Router, ActivatedRoute } from '@angular/router';\r\n\r\nimport { AlertService, AuthenticationService } from '../../services/index';\r\nimport {GlobalService} from \"../../services/global.service\";\r\n\r\n@Component({\r\n    // moduleId: module.id,\r\n    templateUrl: './login.component.html'\r\n})\r\n\r\nexport class LoginComponent implements OnInit {\r\n    model: any = {};\r\n    loading = false;\r\n    returnUrl: string;\r\n\r\n    constructor(\r\n        private route: ActivatedRoute,\r\n        private router: Router,\r\n        private authenticationService: AuthenticationService,\r\n        private alertService: AlertService,\r\n        private globalService : GlobalService\r\n    ) { }\r\n\r\n    ngOnInit() {\r\n        this.returnUrl = this.route.snapshot.queryParams['returnUrl'] || '/';\r\n        if(this.authenticationService.isLogin()) {\r\n            this.router.navigate([this.returnUrl]);\r\n            return;\r\n        }\r\n        this.authenticationService.logout();\r\n        this.globalService.isLogin = false;\r\n        // get return url from route parameters or default to '/'\r\n    }\r\n\r\n    login() {\r\n        this.loading = true;\r\n        this.authenticationService.login(this.model.username, this.model.password)\r\n            .subscribe(\r\n                data => {\r\n                    /**\r\n                     * @param {{err:number,errMessage:string}} data\r\n                     */\r\n                    if (!data.err) {\r\n                        // store user details and jwt token in local storage to keep user logged in between page refreshes\r\n                        localStorage.setItem('currentStore', JSON.stringify(data.store));\r\n                        this.globalService.isLogin = true;\r\n                        this.router.navigate([this.returnUrl]);\r\n                    } else {\r\n                        this.alertService.error(data.errMessage);\r\n                    }\r\n                    this.loading = false;\r\n                },\r\n                error => {\r\n                    this.alertService.error(error._body);\r\n                    this.loading = false;\r\n                });\r\n    }\r\n}\r\n"]}